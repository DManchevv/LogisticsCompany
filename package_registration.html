<div class="card">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Регистриране на нова пратка</h5>
    </div>
    <div class="card-body">
        <form id="shipmentForm" method="POST" action="/shipments">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="sender" class="form-label">Подател</label>
                    <select class="form-select" id="sender" name="sender_id" required>
                        <option value="">Изберете подател</option>
                        <% clients.forEach(client => { %>
                            <option value="<%= client.id %>"><%= client.full_name %> (<%= client.email %>)</option>
                        <% }); %>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="receiver" class="form-label">Получател</label>
                    <select class="form-select" id="receiver" name="receiver_id" required>
                        <option value="">Изберете получател</option>
                        <% clients.forEach(client => { %>
                            <option value="<%= client.id %>"><%= client.full_name %> (<%= client.email %>)</option>
                        <% }); %>
                    </select>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="shipmentType" class="form-label">Тип доставка</label>
                    <select class="form-select" id="shipmentType" name="shipment_type" required>
                        <option value="office">До офис</option>
                        <option value="address">До адрес</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="weight" class="form-label">Тегло (кг)</label>
                    <input type="number" class="form-control" id="weight" name="weight" step="0.01" min="0.1" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="senderOffice" class="form-label">Офис на подаване</label>
                    <select class="form-select" id="senderOffice" name="sender_office_id" required>
                        <option value="">Изберете офис</option>
                        <% offices.forEach(office => { %>
                            <option value="<%= office.id %>"><%= office.name %> - <%= office.address %></option>
                        <% }); %>
                    </select>
                </div>
                <div class="col-md-6">
                    <div id="receiverOfficeSection">
                        <label for="receiverOffice" class="form-label">Офис на получаване</label>
                        <select class="form-select" id="receiverOffice" name="receiver_office_id">
                            <option value="">Изберете офис</option>
                            <% offices.forEach(office => { %>
                                <option value="<%= office.id %>"><%= office.name %> - <%= office.address %></option>
                            <% }); %>
                        </select>
                    </div>
                    <div id="deliveryAddressSection" style="display: none;">
                        <label for="deliveryAddress" class="form-label">Адрес за доставка</label>
                        <textarea class="form-control" id="deliveryAddress" name="delivery_address" rows="2"></textarea>
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Приблизителна цена</label>
                    <div class="alert alert-info" id="priceEstimation">
                        Моля, въведете тегло и тип доставка
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary">Регистрирай пратка</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Calculate price based on weight and shipment type
    document.getElementById('weight').addEventListener('input', calculatePrice);
    document.getElementById('shipmentType').addEventListener('change', function() {
        calculatePrice();
        
        // Toggle address fields
        if (this.value === 'address') {
            document.getElementById('receiverOfficeSection').style.display = 'none';
            document.getElementById('deliveryAddressSection').style.display = 'block';
            document.getElementById('receiverOffice').required = false;
            document.getElementById('deliveryAddress').required = true;
        } else {
            document.getElementById('receiverOfficeSection').style.display = 'block';
            document.getElementById('deliveryAddressSection').style.display = 'none';
            document.getElementById('receiverOffice').required = true;
            document.getElementById('deliveryAddress').required = false;
        }
    });

    function calculatePrice() {
        const weight = parseFloat(document.getElementById('weight').value) || 0;
        const shipmentType = document.getElementById('shipmentType').value;
        
        if (weight <= 0) {
            document.getElementById('priceEstimation').textContent = 'Моля, въведете тегло';
            return;
        }
        
        // Pricing model
        const basePrice = 5;
        const perKgPrice = shipmentType === 'office' ? 0.8 : 1.2;
        const price = basePrice + (weight * perKgPrice);
        
        document.getElementById('priceEstimation').textContent = 
            `Приблизителна цена: ${price.toFixed(2)} лв.`;
    }
</script>
