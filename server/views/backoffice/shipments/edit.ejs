<form action="/bo/shipments/edit/<%= shipment.id %>" method="POST">

  <div class="mb-3">
    <label for="tracking_number" class="form-label">Tracking Number</label>
    <input type="text" class="form-control <% if (errors.find(e => e.param === 'tracking_number')) { %>is-invalid<% } %>" id="tracking_number" name="tracking_number" value="<%= formData.tracking_number || '' %>" required>
    <div class="invalid-feedback">
      <%= errors.find(e => e.param === 'tracking_number')?.msg %>
    </div>
  </div>

  <div class="mb-3">
    <label for="sender_office_id" class="form-label">Sender Office</label>
    <select class="form-select <% if (errors.find(e => e.param === 'sender_office_id')) { %>is-invalid<% } %>" id="sender_office_id" name="sender_office_id" required>
      <option value="">Select sender office</option>
      <% offices.forEach(o => { %>
        <option value="<%= o.id %>" <%= formData.sender_office_id == o.id ? 'selected' : '' %>><%= o.name %></option>
      <% }) %>
    </select>
    <div class="invalid-feedback">
      <%= errors.find(e => e.param === 'sender_office_id')?.msg %>
    </div>
  </div>

  <div class="mb-3">
    <label for="sender_id" class="form-label">Sender</label>
    <select class="form-select <% if (errors.find(e => e.param === 'sender_id')) { %>is-invalid<% } %>" id="sender_id" name="sender_id" required>
      <option value="">Select sender</option>
      <% users.forEach(u => { %>
        <option value="<%= u.id %>" <%= formData.sender_id == u.id ? 'selected' : '' %>><%= u.first_name %> <%= u.last_name %></option>
      <% }) %>
    </select>
    <div class="invalid-feedback">
      <%= errors.find(e => e.param === 'sender_id')?.msg %>
    </div>
  </div>

  <div class="mb-3">
    <label for="receiver_id" class="form-label">Receiver</label>
    <select class="form-select <% if (errors.find(e => e.param === 'receiver_id')) { %>is-invalid<% } %>" id="receiver_id" name="receiver_id">
      <option value="">Select receiver (optional if pending)</option>
      <% users.forEach(u => { %>
        <option value="<%= u.id %>" <%= formData.receiver_id == u.id ? 'selected' : '' %>><%= u.first_name %> <%= u.last_name %></option>
      <% }) %>
    </select>
    <div class="invalid-feedback">
      <%= errors.find(e => e.param === 'receiver_id')?.msg %>
    </div>
  </div>

  <div class="mb-3">
    <label for="delivery_address" class="form-label">Delivery Address</label>
    <input type="text" class="form-control <% if (errors.find(e => e.param === 'delivery_address')) { %>is-invalid<% } %>" id="delivery_address" name="delivery_address" value="<%= formData.delivery_address || '' %>" required>
    <div class="invalid-feedback">
      <%= errors.find(e => e.param === 'delivery_address')?.msg %>
    </div>
  </div>

  <div class="mb-3">
    <label for="weight" class="form-label">Weight (kg)</label>
    <input type="number" step="0.01" class="form-control <% if (errors.find(e => e.param === 'weight')) { %>is-invalid<% } %>" id="weight" name="weight" value="<%= formData.weight || '' %>" required>
    <div class="invalid-feedback">
      <%= errors.find(e => e.param === 'weight')?.msg %>
    </div>
  </div>

  <div class="mb-3">
    <label for="price" class="form-label">Price (â‚¬)</label>
    <input type="number" step="0.01" class="form-control <% if (errors.find(e => e.param === 'price')) { %>is-invalid<% } %>" id="price" name="price" value="<%= formData.price || '' %>" required>
    <div class="invalid-feedback">
      <%= errors.find(e => e.param === 'price')?.msg %>
    </div>
  </div>

  <div class="mb-3">
    <label for="description" class="form-label">Description</label>
    <textarea class="form-control <% if (errors.find(e => e.param === 'description')) { %>is-invalid<% } %>" id="description" name="description"><%= formData.description || '' %></textarea>
    <div class="invalid-feedback">
      <%= errors.find(e => e.param === 'description')?.msg %>
    </div>
  </div>

  <div class="mb-3">
    <label for="status" class="form-label">Status</label>
    <select class="form-select <% if (errors.find(e => e.param === 'status')) { %>is-invalid<% } %>" id="status" name="status" required>
      <option value="">Select status</option>
      <option value="pending" <%= formData.status === 'pending' ? 'selected' : '' %>>Pending</option>
      <option value="registered" <%= formData.status === 'registered' ? 'selected' : '' %>>Registered</option>
      <option value="delivered" <%= formData.status === 'delivered' ? 'selected' : '' %>>Delivered</option>
    </select>
    <div class="invalid-feedback">
      <%= errors.find(e => e.param === 'status')?.msg %>
    </div>
  </div>

  <button type="submit" class="btn btn-primary">Save Changes</button>
  <a href="/bo/shipments" class="btn btn-secondary">Cancel</a>
</form>
